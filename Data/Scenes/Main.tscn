[gd_scene load_steps=5 format=2]

[ext_resource path="res://Data/Util/OptimalLightRenderer.tscn" type="PackedScene" id=1]
[ext_resource path="res://Data/Backgrounds/ImageBG.tscn" type="PackedScene" id=2]
[ext_resource path="res://Data/UI/HUD.tscn" type="PackedScene" id=4]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

const PLAYER := preload(\"res://Data/Scenes/PlayerScene.tscn\")
const NGIOSTATUS := preload(\"res://Data/Scenes/NewgroundsChecker.tscn\")
const NG := preload(\"res://Data/Util/Newgrounds.tscn\")

var editing := true

onready var hud := $HUD
onready var background := $ImageBG
onready var level : TileMap = preload(\"res://Data/Level/Level.tscn\").instance()
onready var fileDialog := preload(\"res://Data/Editor/FileDialog.tscn\").instance()

var currentScene

var attempt := 1

var entityLookTowards := Vector2()

func _ready():
	add_child(fileDialog)
	
	fileDialog.connect(\"popup_hide\", self, \"_dialogHide\")
	fileDialog.popup()
	
func _dialogHide():
	add_child(level)
	level.loadLvl()
	
	changeScene(PLAYER)
	
func plop(pos := Vector2(), rotations := [0, 45, 90, 135, 180, 225, 270, 315]):
	for i in range(rotations.size()):
		var dust = load(\"res://Data/Particles/FastDust.tscn\").instance()
	
		level.add_child(dust)
		dust.global_position = pos
		dust.gravity = 4
		dust.velocity = Vector2(0, -75).rotated(deg2rad(rotations[i]))
	
func changeScene(packedScene):
	var newScene = packedScene.instance()
	
	if currentScene:
		currentScene.call_deferred(\"queue_free\")
		currentScene = null
		
	currentScene = newScene
	call_deferred(\"add_child\", newScene)
	
func _input(event):
	if event is InputEventKey && event.is_pressed() && !event.is_echo():
		if event.scancode == KEY_F9:
			if currentScene.name == \"PlayScene\":
				changeScene(NGIOSTATUS)
			else:
				changeScene(PLAYER)
"

[node name="Main" type="Node2D"]
script = SubResource( 1 )

[node name="HUD" parent="." instance=ExtResource( 4 )]
layer = 128

[node name="ImageBG" parent="." instance=ExtResource( 2 )]

[node name="OptimalLightRenderer" parent="." instance=ExtResource( 1 )]
